@page "/ship"
@using BattleShip.Models
@using BattleShip.App.Components
@inject GameState GameState
@inject NavigationManager Navigation



<div class="game-container">
    <div class="game-card placement-card">
        <div class="placement-layout">
            <ShipPlacementUI GridSize="@GridSize" OnGridSizeChanged="ChangeGridSize" OnPlacementsConfirmed="OnShipsPlaced" />
        </div>
    </div>
</div>

<style>
    .game-container {
        position: relative;
        z-index: 1;
        padding: 2rem;
        min-height: calc(100vh - 60px);
        max-width: 1400px;
        margin: 0 auto;
    }

    .game-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 600px;
        margin: 30px auto;
        border: 3px solid rgba(0, 119, 182, 0.3);
    }

    .placement-card {
        max-width: 1300px;
        width: 95%;
        overflow: visible;
    }

    .placement-layout {
        width: 100%;
        overflow: visible;
    }

    .game-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #0077b6;
        margin-bottom: 2rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
</style>

@code {
    private int GridSize = 10;

    protected override void OnInitialized()
    {
        GameState.SetNavigationManager(Navigation);
    }

    private void ChangeGridSize(int size)
    {
        GridSize = size;
        StateHasChanged();
    }

    private async Task OnShipsPlaced(List<BattleShip.Models.ShipPlacement> placements)
    {
        await GameState.StartNewGameWithPlacements(placements, GridSize);
        // La navigation se fait automatiquement dans StartNewGameWithPlacements
    }
}
